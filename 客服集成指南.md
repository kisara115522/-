# 客服聊天功能集成指南

## 已创建的文件

1. **完整的客服聊天页面**: `src/main/resources/static/customer-service.html`
2. **可嵌入的客服组件**: `src/main/resources/static/js/customer-service-widget.js`

## 方案一：使用独立的客服页面

### 访问方式
直接访问：`http://localhost:8080/customer-service.html`

### 特点
- 完整的聊天界面
- 适合作为独立的客服页面
- 可以通过链接或按钮跳转

## 方案二：在现有页面中嵌入客服组件（推荐）

### 1. 修改现有HTML页面

在每个需要客服功能的页面的 `</body>` 标签前添加：

```html
<!-- 客服聊天组件 -->
<script src="/js/customer-service-widget.js"></script>
```

### 2. 自定义配置（可选）

如果需要自定义配置，可以在引入脚本后添加：

```html
<script>
// 自定义客服组件配置
window.customerService = new CustomerServiceWidget({
    apiUrl: '/chat',  // 后端API地址
    welcomeMessage: '您好！欢迎来到黑马点评，有什么可以帮助您的吗？',
    position: 'bottom-right'  // 位置：bottom-right, bottom-left
});
</script>
```

## 方案三：通过Nginx部署后的集成步骤

### 1. 复制文件到Nginx目录

将以下文件复制到您的Nginx静态资源目录中：

```
复制：src/main/resources/static/js/customer-service-widget.js
到：  nginx目录/html/hmdp/js/customer-service-widget.js

复制：src/main/resources/static/customer-service.html  
到：  nginx目录/html/hmdp/customer-service.html
```

### 2. 修改现有HTML页面

在 `nginx目录/html/hmdp/` 下的每个HTML文件中，找到 `</body>` 标签，在其前面添加：

```html
<!-- 客服聊天组件 -->
<script src="./js/customer-service-widget.js"></script>
```

### 3. 主要需要修改的文件列表

根据您的项目结构，需要修改以下文件：
- `index.html` - 主页
- `shop-list.html` - 商户列表页
- `shop-detail.html` - 商户详情页
- `blog-detail.html` - 笔记详情页
- `info.html` - 个人信息页
- 其他需要客服功能的页面

### 4. Nginx配置调整（重要）

由于客服组件需要调用后端API，需要确保Nginx正确代理到您的Spring Boot应用：

在Nginx配置文件中添加或确认有以下配置：

```nginx
# 代理聊天接口到后端
location /chat {
    proxy_pass http://localhost:8080/chat;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    
    # 支持流式响应
    proxy_buffering off;
    proxy_cache off;
    proxy_set_header Connection '';
    proxy_http_version 1.1;
    chunked_transfer_encoding off;
}
```

## 使用效果

集成完成后，您的每个页面右下角会出现一个紫色的聊天按钮：
- 点击按钮打开聊天窗口
- 支持实时对话
- 自动滚动到最新消息
- 响应式设计，支持手机端
- 流式响应显示

## 注意事项

1. **确保后端接口正常**：客服功能依赖 `/chat` 接口
2. **检查跨域问题**：如果前后端分离部署，注意CORS配置
3. **API密钥配置**：确保 `SILICON_API_KEY` 环境变量已设置
4. **Nginx重启**：修改配置后需要重启Nginx服务

## 测试方法

1. 打开任意页面
2. 查看右下角是否有聊天按钮
3. 点击按钮测试聊天功能
4. 发送测试消息验证后端连接

## 如果遇到问题

1. **按钮不显示**：检查JS文件是否正确加载
2. **无法发送消息**：检查后端API是否正常，查看浏览器控制台错误
3. **样式问题**：可能与现有CSS冲突，检查控制台样式错误

这样您就可以在整个网站中拥有统一的智能客服功能了！
