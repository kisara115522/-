# Nginx配置文件示例 - 支持客服聊天功能
# 将此配置添加到您的nginx.conf中的http块内的server块中

server {
    listen       80;
    server_name  localhost;

    # 静态资源目录 - 您的前端页面
    location / {
        root   html/hmdp;
        index  index.html;
        try_files $uri $uri/ /index.html;
    }
    
    # 代理静态资源到Spring Boot（如果需要）
    location /imgs/ {
        proxy_pass http://localhost:8080/imgs/;
    }
    
    # ========== 客服聊天API代理 ==========
    # 重要：客服功能需要这个配置
    location /chat {
        proxy_pass http://localhost:8080/chat;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 支持流式响应 - 重要配置
        proxy_buffering off;
        proxy_cache off;
        proxy_set_header Connection '';
        proxy_http_version 1.1;
        chunked_transfer_encoding off;
        
        # 超时设置
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # 代理其他API请求到Spring Boot后端
    location /api/ {
        proxy_pass http://localhost:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    # 代理用户相关API
    location /user/ {
        proxy_pass http://localhost:8080/user/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    # 代理商户相关API  
    location /shop/ {
        proxy_pass http://localhost:8080/shop/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    # 代理博客相关API
    location /blog/ {
        proxy_pass http://localhost:8080/blog/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    # 代理商户类型API
    location /shop-type/ {
        proxy_pass http://localhost:8080/shop-type/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}

# 错误页面
error_page   500 502 503 504  /50x.html;
location = /50x.html {
    root   html;
}
